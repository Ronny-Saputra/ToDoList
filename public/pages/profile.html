<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <link rel="stylesheet" href="../styles/profile.css" />
    <link rel="stylesheet" href="../styles/navbar.css" />
    <style>
      /* ============================================= */
      /* DRAWER TASK (UNTUK RESTORE/RESCHEDULE)       */
      /* ID UNIK: taskEditDrawer                       */
      /* ============================================= */

      .task-edit-drawer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1200; /* Lebih tinggi dari edit profile */
        pointer-events: none;
      }

      .task-edit-drawer.active {
        pointer-events: auto;
      }

      .task-edit-drawer .drawer-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .task-edit-drawer.active .drawer-overlay {
        opacity: 1;
        visibility: visible;
      }

      .task-edit-drawer .drawer-content {
        position: absolute;
        top: 0;
        right: -100%;
        width: 90%;
        max-width: 400px;
        height: 100%;
        background: #fff;
        box-shadow: -10px 0 30px rgba(0, 0, 0, 0.2);
        transition: right 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        overflow-y: auto;
        display: flex;
        flex-direction: column;
      }

      .task-edit-drawer.active .drawer-content {
        right: 0;
      }

      /* HEADER TASK DRAWER */
      .task-edit-drawer .drawer-header {
        background: linear-gradient(to bottom, #dde8f8, #b9d4f5, #9ac1f0);
        padding: 20px 50px;
        display: flex;
        align-items: center;
        gap: 16px;
        color: #14142a;
        flex-shrink: 0;
        border-radius: 0 0 25px 25px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .task-edit-drawer .drawer-header h2 {
        font-size: 18px;
        font-weight: 600;
        color: #14142a;
        margin: 0;
      }

      .task-edit-drawer .drawer-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #333;
        cursor: pointer;
      }

      /* FORM TASK DRAWER */
      .task-edit-drawer .reminder-form {
        padding: 20px 24px 30px 24px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        overflow-y: auto;
        flex-grow: 1;
      }

      .task-edit-drawer .form-section {
        display: flex;
        flex-direction: column;
        position: relative;
      }

      .task-edit-drawer .form-section label {
        font-size: 14px;
        font-weight: 500;
        color: #333;
        margin-bottom: 5px;
      }

      .task-edit-drawer .input-field {
        width: 100%;
        padding: 15px 12px;
        border: 1px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
        background-color: #fff;
        transition: border-color 0.2s;
      }

      .task-edit-drawer .input-field:focus {
        outline: none;
        border-color: #3f67b5;
      }

      /* Priority Selector di Task Drawer */
      .task-edit-drawer .priority-selector {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 12px;
        border: 1px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
        background-color: #fff;
        cursor: pointer;
        transition: border-color 0.2s;
      }

      .task-edit-drawer .priority-selector:hover {
        border-color: #3f67b5;
      }

      .task-edit-drawer .priority-selector span {
        color: #333;
      }

      .task-edit-drawer .priority-selector i {
        color: #a8b0c6;
        font-size: 14px;
      }

      /* Priority Dropdown untuk Task Drawer */
      .task-edit-drawer .priority-dropdown-wrapper {
        position: absolute;
        top: 70px;
        left: 0;
        right: 0;
        z-index: 1000;
        visibility: hidden;
        opacity: 0;
        transform: translateY(-10px);
        transition:
          opacity 0.2s ease,
          transform 0.2s ease,
          visibility 0.2s ease;
      }

      .task-edit-drawer .priority-dropdown-wrapper.open {
        visibility: visible;
        opacity: 1;
        transform: translateY(0);
      }

      .task-edit-drawer .priority-dropdown {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        border: 1px solid #ddd;
        overflow: hidden;
      }

      .task-edit-drawer .priority-option {
        padding: 12px 16px;
        font-size: 15px;
        color: #333;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: background-color 0.1s ease;
      }

      .task-edit-drawer .priority-option:hover {
        background-color: #f0f4f9;
      }

      .task-edit-drawer .priority-option:not(:last-child) {
        border-bottom: 1px solid #eee;
      }

      .task-edit-drawer .priority-option i.fa-check {
        color: #1e2a78;
        font-size: 14px;
      }

      /* Add Details Button */
      .task-edit-drawer .add-details-btn {
        background-color: #f7f7f7;
        border: 1px solid #ddd;
        color: #3f67b5;
        padding: 15px 12px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 12px;
        transition: background-color 0.2s;
      }

      .task-edit-drawer .add-details-btn:hover {
        background-color: #f0f0f0;
      }

      .task-edit-drawer .add-details-btn i {
        color: #3f67b5;
        font-size: 18px;
      }

      .task-edit-drawer .description-field {
        min-height: 100px;
        resize: vertical;
      }

      .task-edit-drawer .save-btn {
        background-color: #1e2a78;
        color: #fff;
        border: none;
        padding: 15px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 20px;
      }

      /* RESPONSIVE */
      @media (max-width: 480px) {
        .task-edit-drawer .drawer-content {
          width: 100%;
          max-width: none;
        }

        .task-edit-drawer .drawer-header {
          padding: 20px 24px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="profile-header">
        <div class="profile-left">
          <div class="profile-avatar">
            <img src="../assets/avatar.png" alt="User Avatar" id="mainAvatar" />
            <span class="camera-icon">
              <img src="../assets/mdi_camera.svg" alt="Camera" />
            </span>
          </div>

          <div class="profile-details">
            <div class="user-streak-wrapper">
              <div class="username" id="profileUsername">Username</div>
              <div class="streak">
                <i class="fas fa-fire"></i>
                <span id="profileStreakNumber">0</span>
              </div>
            </div>
            <button class="edit-profile-btn" id="openEditDrawer">
              Edit Profile
            </button>
          </div>
        </div>

        <a href="settings.html" class="settings-btn">
          <img
            src="../assets/settings.svg"
            alt="Settings"
            class="settings-icon"
          />
        </a>
      </header>

      <main class="main-content">
        <div class="content-wrapper">
          <div class="stats-section">
            <div class="tabs">
              <button class="tab-btn active" id="dailyTab">Daily</button>
              <button class="tab-btn" id="weeklyTab">Weekly</button>
              <button class="tab-btn" id="monthlyTab">Monthly</button>
            </div>

            <section class="stats-card">
              <div class="card-header">
                <h3 id="cardTitle">Daily Productivity Statistics</h3>
                <div class="productivity-score">
                  <i class="fas fa-fire"></i>
                  <span class="score-value" id="productivityScore">0</span>
                </div>
              </div>

              <div class="chart-container" id="chartContainer"></div>

              <div class="chart-labels" id="chartLabels">
                <span class="label">M</span>
                <span class="label">T</span>
                <span class="label">W</span>
                <span class="label">T</span>
                <span class="label">F</span>
                <span class="label">S</span>
                <span class="label">S</span>
              </div>
            </section>
          </div>

          <aside class="task-summary">
            <div class="summary-box completed">
              <span>Completed Tasks (0)</span>
              <div class="icon-wrapper">
                <i class="far fa-circle-check"></i>
              </div>
            </div>
            <div class="summary-box missed">
              <span>Missed Tasks (0)</span>
              <div class="icon-wrapper">
                <img
                  src="../assets/exclamation.svg"
                  alt="Exclamation"
                  class="icon-outline"
                />
              </div>
            </div>
            <div class="summary-box deleted">
              <span>Deleted Tasks (0)</span>
              <div class="icon-wrapper">
                <i class="far fa-circle-xmark"></i>
              </div>
            </div>
          </aside>
        </div>
      </main>
    </div>

    <div id="cameraChoiceModal" class="camera-modal">
      <div class="modal-content" style="max-width: 350px; padding: 24px">
        <div
          class="modal-header"
          style="
            background: none;
            padding: 0 0 16px;
            color: #1e2a78;
            justify-content: center;
          "
        >
          <h3>Change Profile Photo</h3>
        </div>
        <div style="display: flex; flex-direction: column; gap: 16px">
          <button id="openCameraBtn" class="btn-choice">
            <i class="fas fa-camera"></i> Take Photo
          </button>
          <button id="uploadPhotoBtn" class="btn-choice">
            <i class="fas fa-image"></i> Upload from Gallery
          </button>
          <button
            id="closeChoiceModal"
            class="btn-choice"
            style="background: #eee; color: #555"
          >
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </div>
    </div>

    <div id="cameraModal" class="camera-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Change Profile Photo</h3>
          <button class="close-modal">Ã—</button>
        </div>

        <video id="video" autoplay playsinline></video>
        <canvas id="canvas" style="display: none"></canvas>
        <input
          type="file"
          id="fileInput"
          accept="image/*"
          style="display: none"
        />

        <div id="captureControls" class="controls">
          <button id="switchCameraBtn" class="btn-secondary">
            <i class="fas fa-sync-alt"></i> Switch to Back Camera
          </button>
          <button id="captureBtn" class="btn-primary">
            <i class="fas fa-camera"></i>
          </button>
        </div>

        <div id="previewControls" class="controls" style="display: none">
          <img id="preview" alt="Preview" />
          <div class="btn-group">
            <button id="setPhoto" class="btn-success">Set Photo</button>
            <button id="retake" class="btn-secondary">Retake</button>
          </div>
        </div>
      </div>
    </div>

    <div class="edit-profile-drawer" id="editProfileDrawer">
      <div class="drawer-overlay" id="drawerOverlay"></div>
      <div class="drawer-content">
        <div class="drawer-header">
          <button class="drawer-close" id="closeDrawer">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h2>Edit Profile</h2>
        </div>

        <div class="profile-avatar">
          <div class="avatar-circle">
            <img
              src="../assets/avatar2.svg"
              alt="Avatar"
              class="avatar-img"
              id="drawerAvatar"
            />
          </div>
          <button class="edit-avatar-btn" id="editAvatarBtn">Edit</button>
        </div>

        <form class="profile-form">
          <div class="form-group">
            <label for="name">Name</label>
            <input
              type="text"
              id="name"
              placeholder="Name"
              class="form-input"
            />
          </div>

          <div class="form-group">
            <label for="username">Username</label>
            <input
              type="text"
              id="username"
              placeholder="Username"
              class="form-input"
            />
          </div>

          <div class="form-group">
            <label>Gender</label>
            <div class="gender-wrapper">
              <div class="gender-input" id="genderInput">
                <span id="selectedGender">Male</span>
                <i class="fas fa-chevron-down"></i>
              </div>
              <div class="gender-dropdown" id="genderDropdown">
                <div class="gender-option" data-value="Male">
                  <i class="fas fa-check"></i> Male
                </div>
                <div class="gender-option" data-value="Female">
                  <i class="fas fa-check hidden"></i> Female
                </div>
              </div>
            </div>
          </div>

          <button type="button" class="save-btn">SAVE</button>
        </form>
      </div>
    </div>

    <div class="completed-drawer" id="completedDrawer">
      <div class="drawer-overlay" id="completedDrawerOverlay"></div>
      <div class="drawer-content">
        <div class="drawer-header">
          <button class="drawer-close" id="closeCompletedDrawer">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h2>Completed Tasks</h2>
        </div>
        <div id="completedDrawerContent" class="drawer-body"></div>
      </div>
    </div>

    <div class="deleted-drawer" id="deletedDrawer">
      <div class="drawer-overlay" id="deletedDrawerOverlay"></div>
      <div class="drawer-content">
        <div class="drawer-header">
          <button class="drawer-close" id="closeDeletedDrawer">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h2>Deleted Tasks</h2>
        </div>
        <div id="deletedDrawerContent" class="drawer-body"></div>
      </div>
    </div>

    <div class="missed-drawer" id="missedDrawer">
      <div class="drawer-overlay" id="missedDrawerOverlay"></div>
      <div class="drawer-content">
        <div class="drawer-header">
          <button class="drawer-close" id="closeMissedDrawer">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h2>Missed Tasks</h2>
        </div>
        <div id="missedDrawerContent" class="drawer-body"></div>
      </div>
    </div>
    <div class="task-edit-drawer" id="taskEditDrawer">
      <div class="drawer-overlay" id="taskEditDrawerOverlay"></div>
      <div class="drawer-content">
        <div class="drawer-header">
          <button class="drawer-close" id="closeTaskEditDrawer">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h2 id="taskEditDrawerTitle">Edit Task</h2>
        </div>

        <form class="reminder-form" id="task-edit-form">
          <div class="form-section">
            <label>Activity</label>
            <input
              type="text"
              id="task-activity-input"
              placeholder="Activity Name"
              class="input-field"
            />
          </div>

          <div class="form-section">
            <label>Date</label>
            <input type="date" id="task-date-input" class="input-field" />
          </div>

          <div class="form-section">
            <label>Time</label>
            <input
              type="text"
              id="task-time-input"
              placeholder="Start - End Time"
              class="input-field"
              readonly
            />
          </div>

          <div class="form-section">
            <label>Location</label>
            <input
              type="text"
              id="task-location-input"
              placeholder="Location Name"
              class="input-field"
            />
          </div>

          <div class="form-section" id="task-priority-section">
            <label>Priority</label>
            <div class="priority-selector" id="task-priority-selector">
              <span>None</span>
              <i class="fas fa-chevron-right"></i>
            </div>
          </div>

          <div class="form-section">
            <div class="add-details-btn" id="task-add-details-btn">
              <i class="fas fa-plus"></i> Add Details
            </div>
            <input
              type="text"
              placeholder="Details / Description"
              class="input-field description-field"
              id="task-description-input"
              style="display: block"
            />
          </div>

          <button type="submit" class="save-btn" id="task-save-btn">
            Save
          </button>
        </form>
      </div>
    </div>

    <div id="custom-dialog-overlay" class="custom-dialog-overlay">
      <div class="custom-dialog">
        <div id="custom-dialog-message" class="custom-dialog-message"></div>
        <div id="custom-dialog-actions" class="custom-dialog-actions"></div>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="../firebase-init.js"></script>

    <script src="../navbar.js"></script>
    <script src="../main.js"></script>
    <script src="../statistic.js"></script>
    <script src="../edit_profile.js"></script>
    <script src="../profile.js"></script>
  </body>
</html>
